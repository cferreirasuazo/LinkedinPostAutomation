{%load static%}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PostIn</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="{% static 'plugins/fontawesome-free/css/all.min.css' %}">
  <link rel="stylesheet" href="{% static 'plugins/fontawesome-free/css/v4-shims.css' %}">

  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Tempusdominus Bootstrap 4 -->
  <link rel="stylesheet" href="{% static 'plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css' %}">
  <!-- iCheck -->
  <link rel="stylesheet" href="{% static 'plugins/icheck-bootstrap/icheck-bootstrap.min.css' %}">
  <!-- Theme style -->
  <link rel="stylesheet" href="{% static 'dist/css/adminlte.min.css'%}">
  <!-- overlayScrollbars -->
  <link rel="stylesheet" href="{% static 'plugins/overlayScrollbars/css/OverlayScrollbars.min.css' %}">
  <!-- Daterange picker -->
  <link rel="stylesheet" href="{% static 'plugins/daterangepicker/daterangepicker.css' %}">
  <!-- summernote -->
  <link rel="stylesheet" href="{% static 'plugins/summernote/summernote-bs4.min.css' %}">
</head>

<body class="">

  <div class="wrapper">
    <nav class="navbar navbar-expand navbar-white navbar-light">
      <div class="container">
        <a class="navbar-brand" href="#">Navbar</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
          aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="#">Home</a>
            </li>
            <li class="nav-item">
              <button type="button" class="btn btn-default" data-toggle="modal" data-target="#add-post-modal">
                Add Post
              </button>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Pricing</a>
            </li>
            <li class="nav-item">

            </li>
          </ul>

          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" data-widget="fullscreen" href="#" role="button">
                <i class="fas fa-expand-arrows-alt"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-widget="control-sidebar" data-controlsidebar-slide="true" href="#" role="button">
                <i class="fas fa-th-large"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-widget="control-sidebar" data-controlsidebar-slide="true" href="#" role="button">
                <i class="fas fa-door-closed"> logout</i>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="content-wrap">
      <div class="content-head">
        <div class="container">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1 class="m-0">Dashboard v3</h1>
            </div>
            <div class="col-sm-6">
              <button type="button" class="btn btn-block btn-outline-primary btn-flat">
                <i class="fa fa-linkedin-square"></i> Connect
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="infos">
        <div class="container">
          <div class="callout callout-info">
            <h5><i class="fas fa-info"></i> Note:</h5>
            This page has been enhanced for printing. Click the print button at the bottom of the invoice to test.
          </div>

        </div>
      </div>
      <div class="content-body">
        <div class="container">

          <div class="row mb-2">
            <div class="">

              {% for post in posts %}
              <div class="card post" id="{{post.id}}" >
                <div class="card-header">
                  <h5 class="card-title m-0">{{post.id}}</h5>
                </div>
                <div class="card-body">
                  <h6 class="card-title">
                    Special title treatment
                    <small class="badge badge-warning"><i class="far fa-clock"></i> Status</small>
                  </h6>
                  <p class="card-text">{{post.text}}</p>
                  <a class="btn btn-primary">Update</a>
                  <a class="btn btn-danger btn-delete">Delete</a>
                  <a class="btn btn-info">Publish</a>
                </div>
              </div>
              {% endfor %}

            </div>
          </div>
        </div>


      </div>
    </div>

    <div class="modal fade" id="add-post-modal" style="display: none;" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <form id="create-post">
            <div class="modal-header">
              <h4 class="modal-title">Add Post</h4>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">×</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="form-group">
                <label for="text">Post body</label>
                <textarea name="text" class="form-control" name="text" rows="5"
                  placeholder="write something ..."></textarea>
              </div>

              <div class="form-group">
                <label>Publish Date</label>
                <div class="input-group date" id="publishdate" data-target-input="nearest">
                  <input type="text" class="form-control datetimepicker-input" name="publish_date"
                    data-target="#publishdate">
                  <div class="input-group-append" data-target="#publishdate" data-toggle="datetimepicker">
                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                  </div>
                </div>
              </div>
              <div class="form-check">
                <input type="checkbox" name="to_publish" class="form-check-input" id="toPublishCheck">
                <label class="form-check-label" for="toPublishCheck">To publish</label>
              </div>

              <div class="container mt-2">
                <div class="alert alert-warning alert-dismissible">
                  <p><i class="icon fas fa-exclamation-triangle"></i> Warning alert preview. This alert is dismissable.
                  </p>
                </div>
              </div>
            </div>
            <div class="modal-footer justify-content-between">
              <button type="submit" class="btn btn-primary">Save changes</button>
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </form>
        </div>

      </div>
    </div>
    <div class="modal fade" id="modal-default">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Default Modal</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">×</span>
            </button>
          </div>
          <div class="modal-body">
            <p>One fine body…</p>
          </div>
          <div class="modal-footer justify-content-between">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="modal-default">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Default Modal</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">×</span>
            </button>
          </div>
          <div class="modal-body">
            <p>One fine body…</p>
          </div>
          <div class="modal-footer justify-content-between">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="modal-default">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Default Modal</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">×</span>
            </button>
          </div>
          <div class="modal-body">
            <p>One fine body…</p>
          </div>
          <div class="modal-footer justify-content-between">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- ./wrapper -->
  <div class="container">
    <footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top">
      <p class="col-md-4 mb-0 text-muted">© 2022 Company, Inc</p>

      <ul class="nav col-md-4 justify-content-end">
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Home</a></li>
      </ul>
    </footer>
  </div>
  <!-- jQuery -->
  <script src="{% static 'plugins/jquery/jquery.min.js' %}"></script>
  <!-- jQuery UI 1.11.4 -->
  <script src="{% static 'plugins/jquery-ui/jquery-ui.min.js' %}"></script>
  <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
  <script>
    $.widget.bridge('uibutton', $.ui.button)
  </script>

  <script src="{% static 'dist/js/form_validation/form_validation.js'  %}"></script>


  <!-- Bootstrap 4 -->
  <script src="{% static 'plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <!-- ChartJS -->
  <script src="{% static 'plugins/chart.js/Chart.min.js' %}"></script>
  <!-- Sparkline -->
  <script src="{% static 'plugins/sparklines/sparkline.js' %}"></script>
  <!-- jQuery Knob Chart -->
  <script src="{% static 'plugins/jquery-knob/jquery.knob.min.js' %}"></script>
  <!-- Jquery Validate -->
  <script src="{% static 'plugins/jquery-validation/jquery.validate.min.js' %}"></script>
  <script src="{% static 'plugins/jquery-validation/additional-methods.min.js' %}"></script>
  <!-- daterangepicker -->
  <script src="{% static 'plugins/moment/moment.min.js' %}"></script>
  <script src="{% static 'plugins/daterangepicker/daterangepicker.js'%}"></script>
  <!-- Tempusdominus Bootstrap 4 -->
  <script src="{% static 'plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js' %}"></script>
  <!-- Summernote -->
  <script src="{% static 'plugins/summernote/summernote-bs4.min.js'%}"></script>
  <!-- overlayScrollbars -->
  <script src="{% static 'plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js' %}"></script>
  <!-- AdminLTE App -->
  <script src="{% static 'dist/js/adminlte.js' %}"></script>
  <script  src="{% static 'dist/js/api/endpoints.js' %}"> </script>
  <script  src="{% static 'dist/js/api/methods.js' %}"> </script>
 
  <script>

    var csrf = "{{ csrf_token }}"

    $('#publishdate').datetimepicker({ icons: { time: 'far fa-clock' }, format: "YYYY-MM-DDThh:mm:ssZ" });

    let validator = {
      "submitHandler": async (form) => {
        let data = $('#create-post').serializeArray()
        let arr = data.map((object) => {
          var data = {}

          if (object.name == "to_publish") {
            if (object.value == "on") {
              data[object.name] = true
            } else {
              data[object.name] = false
            }
          } else {
            data[object.name] = object.value
          }
          return data
        })

        let request_data = Object.assign(...arr)
        console.log(request_data)
        let {result, data: post_data, error } = createPost(request_data)

      },
      "rules": {
        "text": "required",
        "publish_date": {
          "required": true,
        },
        "to_publish": {
          "required": false
        }
      }
    }

    $(document).ready(function () {

      $(".post").click((e)=>{
        let id = e.currentTarget.id;
        let post = e.currentTarget;

        if(Array.from(e.target.classList).indexOf("btn-delete") > -1){
            post.remove()
        }

        if(Array.from(e.target.classList).indexOf("btn-update") > -1){
          console.log("UPDATE")
        }

        if(Array.from(e.target.classList).indexOf("btn-publish") > -1){
          // Call API
          // UPDATE STATUS 
        }

        
      })

      $("#create-post").validate(validator)
    })
  </script>
</body>

</html>